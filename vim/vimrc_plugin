""vim plugin setting
"

"""""seiya.vim "{{{
"vimの背景を透過
let g:seiya_auto_enable=1
"}}}

"""""taglist.vim "{{{
"tag設定
set tags=tags;,./tags;
let Tlist_Exit_OnlyWindow = 1
if has('gui_running')
    let Tlist_WinWidth = 45
else
    let Tlist_WinWidth = 35
endif
"set splitbelow
"候補が複数ある場合にリストを表示
nnoremap <c-]> g<c-]>
"<space>をlocal用のmappingにする。
nnoremap <silent> <Leader>t :Tlist<CR>
"jump先をnew tabで開く
nnoremap <c-j> :execute("tabnew " . b:cfile)<CR> <c-o> :execute("tjump " . expand('<cword>'))<CR>
"]でtag listから抜ける
"autocmd local FileType taglist nnoremap <buffer> <Esc> <c-w>p
autocmd local FileType taglist nnoremap <buffer> ] <c-w>l <c-w>k

"taglistを縦分割で使う際に横ではなく下にlistが出るように変更する関数
function! Tlist_Horizon()
    let g:Tlist_Use_Horiz_Window=1
    Tlist
endfunction
"}}}

"""""NERDTree "{{{
"Bookmarkをデフォルト表示
let g:NERDTreeShowBookmarks=1
"見栄え
let g:NERDTreeDirArrows = 1
let g:NERDTreeDirArrowExpandable  = '>'
let g:NERDTreeDirArrowCollapsible = '!'

"参考:https://kamiya555.github.io/2015/10/14/nerdtree-command/
"local mapping
nnoremap <silent> <Leader>n :NERDTree<CR>

"]でnerdtreeから抜け
"autocmd local FileType nerdtree nnoremap <buffer> <Esc> <c-w>p
autocmd local FileType nerdtree nnoremap <buffer> ] <c-w>l <c-w>k
"}}}

"""""mftags{{{
let g:mftag_c_enable_kinds = "cdfgstu"
let g:mftag_syntax_c_enable_kinds = "cdfgstu"
let g:mftag_auto_close = 1
"]でfunction listから抜ける
autocmd local FileType FuncList nnoremap <buffer> ] <c-w>l <c-w>k

nnoremap <silent> <Leader>m :MFfunclist f<CR>

function! s:Mygrep(...)
    "args 1 ... search word.
    "args 2 ... file extention.
    if a:0 == '0'
        let l:word = expand('<cword>')
        let l:ft = expand('%:e')
    elseif a:0 == '1'
        let l:word = a:1
        let l:ft = expand('%:e')
    else
        let l:word = a:1
        let l:ft = a:2
    endif
    if &grepprg == "internal"
        execute 'grep /' . l:word . '/j ' . MFsearch_dir(g:mftag_dir) . '**/*.' . l:ft
    "elseif &grepprg == "grep\ -n"
    elseif &grepprg == "grep\ -n\ -r\ -i\ --binary-files=without-match"
        execute "set grepprg=grep\\ -n\\ -r\\ -i\\ --binary-files=without-match\\ --include=\\\\*." . l:ft
        "echomsg &grepprg
        execute 'grep ' . l:word . ' ' . MFsearch_dir(g:mftag_dir) . " | normal "
        set grepprg=grep\ -n\ -r\ -i\ --binary-files=without-match
    elseif &grepprg == "grep\ -n\ $*\ /dev/null"
        execute 'grep "' . l:word . '" ' . MFsearch_dir(g:mftag_dir) . '**/*.' . l:ft
    else
        echo "not supported grepprg"
    endif
endfunction
command! -nargs=* Gregrep call s:Mygrep(<f-args>)

"command! -nargs=1 Gregrep execute "grep /" . <f-args> . "/j " . MFsearch_dir(g:mftag_dir) . '**/*.' . expand('%:e')

"autocmd BufRead * execute "set path+=" . b:mftag_save_dir . "**/include"
function! s:AddPath()
    if exists("b:mftag_save_dir")
        if b:mftag_save_dir != "/"
            execute "set path+=" . b:mftag_save_dir . "**/include"
        endif
    endif
endfunction
autocmd BufRead * call s:AddPath()
"}}}

""""ctrlp{{{
nnoremap <leader>s :<C-U>CtrlP<CR>

"}}}

